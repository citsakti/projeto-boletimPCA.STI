/* TOC.css - Estilos do índice lateral analítico */

:root { 
  --toc-width: 250px; 
  /* Espaço reservado quando o TOC está recolhido para o botão não sobrepor o conteúdo */
  --toc-collapsed-button-space: 64px; /* 40px botão + 15px margem + ~9px respiro */
}

/* Layout fixo geral */
body.with-fixed-layout { overflow-x: hidden; }
#main-header { position: fixed; top:0; left:0; right:0; z-index: 1030; background: transparent; }
#main-header > .col-12 > .d-flex { background: var(--brand-primary, #0d6efd); border-radius: 0 0 .5rem .5rem; padding-inline: 1rem; }
#toolbar-row { position: fixed; top: var(--header-height, 70px); left:0; right:0; z-index:1031; }
#main-toolbar { background: #f8f9fa!important; box-shadow: 0 2px 4px rgba(0,0,0,.08); }
.main-content-wrapper { position: relative; }

/* Container do índice fixo */
.toc-container { position: fixed; left: 0; top: var(--fixed-toc-top, 140px); width: var(--toc-width); bottom: 0; background:#f8f9fa; border-right:1px solid #dee2e6; padding: 1rem .85rem 1.25rem; overflow-y:auto; font-size:.9rem; z-index:1029; }

/* Ajustar coluna principal para não ficar sob o TOC */
@media (min-width: 992px) { 
  .main-content-wrapper .row.gx-3 > .col { margin-left: var(--toc-width); transition: margin-left .25s ease; }
  body.toc-collapsed .main-content-wrapper .row.gx-3 > .col { margin-left: var(--toc-collapsed-button-space); }
  /* Ajustar também qualquer footer interno alinhado ao grid */
  body.toc-collapsed footer.row { padding-left: 0; }
}

.toc-title {
  font-weight: 600;
  text-transform: uppercase;
  font-size: 0.75rem;
  letter-spacing: .05em;
  color: #6c757d;
  margin-bottom: .5rem;
  position: relative;
}

/* Botão flutuante para expandir/recolher índice */
.toc-toggle-sidebar-btn {
  position: fixed;
  /* Posiciona o botão colado na borda direita do índice, avançando alguns pixels */
  left: calc(var(--toc-width) - 50px);
  top: calc(var(--fixed-toc-top, 140px) + 10px);
  z-index: 3000 !important; /* acima de overlays comuns e do próprio TOC */
  pointer-events: auto;
  /* Prevenir clipping em algum ancestor inesperado */
  contain: layout style paint; /* evita criação de stacking context acidental externo interferir */
  width: 40px;
  height: 40px;
  padding: 0 !important;
  display: flex !important;
  align-items: center;
  justify-content: center;
  border-radius: 8px !important;
  background: white !important;
  border: 2px solid #0d6efd !important;
  transition: all 0.3s ease;
  box-shadow: 0 2px 8px rgba(0,0,0,0.15) !important;
  color: #0d6efd !important;
}

.toc-toggle-sidebar-btn:hover {
  background: #0d6efd !important;
  color: white !important;
  border-color: #0d6efd !important;
  transform: scale(1.08);
  box-shadow: 0 4px 12px rgba(13, 110, 253, 0.3) !important;
}

body.toc-collapsed .toc-toggle-sidebar-btn {
  left: 15px;
  background: #0d6efd !important;
  color: #fff !important;
}

/* Força o TOC a não sobrepor o botão mesmo visivelmente (garantia extra) */
#toc-container { z-index: 1029; }

.toc-toggle-sidebar-btn i {
  font-size: 1.3rem;
  transition: transform 0.3s ease;
  line-height: 1;
}

/* Esconder botão flutuante em mobile */
@media (max-width: 991.98px) {
  .toc-toggle-sidebar-btn {
    display: none !important;
  }
}

/* Transição suave do sidebar */
#toc-sidebar {
  transition: all 0.3s ease;
}

/* Colapso via classe no body (desktop) */
@media (min-width: 992px){
  body.toc-collapsed #toc-sidebar { display: none !important; }
}

/* Animação simulada de fade ao colapsar */
@media (min-width: 992px){
  #toc-sidebar { opacity: 1; transition: opacity .2s ease; }
  body.toc-collapsed #toc-sidebar { opacity: 0; }
}

/* Ajustar botão quando hover enquanto colapsado */
body.toc-collapsed .toc-toggle-sidebar-btn:hover { filter: brightness(1.05); }

/* Elevar conteúdo para largura cheia quando colapsado */
body.toc-collapsed .analytics-dashboard { transition: padding .25s ease; }

.toc-list { list-style: none; margin: 0; padding: 0; }
.toc-list > li { margin: 0 0 .25rem 0; padding: 0; }
.toc-sublist { list-style: none; padding-left: .75rem; margin: .25rem 0 .5rem; border-left: 2px solid #e2e3e5; }
.toc-sublist li { margin:0; }

.toc-link { display: block; padding: .35rem .5rem; border-radius: .25rem; color: #212529; text-decoration: none; transition: background .15s, color .15s; line-height: 1.2; }
.toc-link:hover { background: #e9ecef; text-decoration: none; }
.toc-link.active { background: var(--brand-primary, #0d6efd); color: #fff; font-weight: 600; }
.toc-sublist .toc-link { font-size: .78rem; padding: .25rem .5rem; }

/* Ajustes de ancoragem (evita que header + toolbar fixos cubram o título) */
html { scroll-behavior: smooth; }
@media (min-width: 992px){
  .analytics-section h2, .analytics-section h3 { 
    /* header + toolbar calculados via JS + respiro adicional */
    scroll-margin-top: calc(var(--header-height, 70px) + var(--toolbar-height, 60px) + 18px);
  }
}
@media (max-width: 991.98px){
  /* Em mobile não há header/toolbar fixos, manter offset menor */
  .analytics-section h2, .analytics-section h3 { scroll-margin-top: 72px; }
}

/* Destaque temporário ao navegar pelo TOC */
.toc-highlight-temp {
  position: relative;
  animation: tocFlash 1.2s ease;
}
@keyframes tocFlash {
  0% { box-shadow: 0 0 0 0 rgba(13,110,253,0.0); background:rgba(13,110,253,0.08); }
  40% { box-shadow: 0 0 0 4px rgba(13,110,253,0.25); background:rgba(13,110,253,0.12); }
  100% { box-shadow: 0 0 0 0 rgba(13,110,253,0); background:transparent; }
}

/* Reduções progressivas de largura */
@media (max-width: 1600px) { :root { --toc-width: 230px; } }
@media (max-width: 1400px) { :root { --toc-width: 210px; } }
@media (max-width: 1250px) { :root { --toc-width: 190px; } .toc-link { font-size: .8rem; } }
@media (max-width: 1100px) { :root { --toc-width: 170px; } .toc-link { font-size: .75rem; } .toc-sublist .toc-link { font-size: .7rem; } }

/* Mobile */
@media (max-width: 991.98px) { 
  #main-header, #toolbar-row { position: static; }
  .toc-container { position: static; top: auto!important; width: 100%; max-height: none; border:1px solid #e2e3e5; display: none; margin-top: .5rem; border-right:none; }
  .main-content-wrapper .row.gx-3 > .col { margin-left: 0!important; }
  .toc-toggle-btn { display: inline-flex; }
}

.toc-toggle-btn { position: fixed; top: 10px; left: 10px; z-index: 1100; display: none; }

/* Quando o TOC está visível em mobile via JS */
@media (max-width: 991.98px) { .toc-container.toc-visible { display: block !important; } }

/* Ajuste visual quando visível em mobile */
.toc-container.toc-visible { display:block !important; }

/* Barra de rolagem mais discreta dentro do índice */
.toc-container::-webkit-scrollbar { width: 8px; }
.toc-container::-webkit-scrollbar-track { background: transparent; }
.toc-container::-webkit-scrollbar-thumb { background: #ced4da; border-radius: 4px; }
.toc-container::-webkit-scrollbar-thumb:hover { background: #adb5bd; }
